<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>记录光标位置</title>
    <script type="text/javascript">
        function insertText(obj, str) {
            if (document.selection) {
                obj.focus();
                document.selection.createRange().text = str;

            } else if (typeof obj.selectionStart==='number') {
                var startPos = obj.selectionStart;
                var endPos = obj.selectionEnd;
                var cursorPos = startPos;
                var tmpStr = obj.value;

                obj.value = tmpStr.substring(0, startPos) + str + tmpStr.substring(endPos, tmpStr.length);
                cursorPos += str.length;
                obj.selectionStart = obj.selectionEnd = cursorPos;
            } else {
                obj.value += str;
            }
        }

        function moveEnd(obj) {
            obj.focus();
            var len = obj.value.length;
            if (document.selection) {
                var sel = obj.createTextRange();
                sel.moveStart('character', len); // 将开始光标置于字符数组中指定的位置
                sel.collapse();// 必须要调用此方法 将插入点移动到当前范围的开始或结尾。
                sel.select();// 必须要调用此方法 将当前选中区置为当前对象。
            } else if (typeof obj.selectionStart==='number') {
                obj.selectionStart = obj.selectionEnd = len;
            }
        }

        var flag = 0;

        function seqMove(obj) {
            flag++;
            obj.focus();
            if (document.selection) {
                var range = obj.createTextRange();
                range.move('character', flag);  // flag 参数表示字符数组中的指定位置,可以根据此参数指定光标的位置
                range.select(); // 必须要调用此方法
            }
        }
    </script>
</head>
<body>
    <textarea rows="20" cols="100" id="txt"></textarea>
    <br />
    <input type="button" value="移动到结尾" onclick='moveEnd(document.getElementById("txt"));' />
    <input type="button" value="插入值" onclick='insertText(document.getElementById("txt"),"zhangjin");' />

    <input type="button" value="顺序移动" onclick='seqMove(document.getElementById("txt"));' />

</body>
</html>
